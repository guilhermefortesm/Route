<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autocomplete Endereço e Gerar Rota</title>
    <!-- Inclua a API do Google Maps com a biblioteca Places -->
    <script src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_DA_API&libraries=places"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #endereco {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        #adicionar-endereco {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #lista-enderecos {
            margin-top: 20px;
        }
        .endereco-item {
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remover-endereco {
            color: red;
            cursor: pointer;
        }
        #gerar-rota {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        #qr-code {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Insira os endereços</h1>
    <input type="text" id="endereco" placeholder="Digite um endereço">
    <button id="adicionar-endereco">Adicionar Endereço</button>

    <div id="lista-enderecos"></div>

    <button id="gerar-rota">Gerar Rota e QR Code</button>

    <div id="qr-code">
        <img id="qr-code-image" src="" alt="QR Code da Rota" style="display: none;">
    </div>

    <script>
        // Inicializa o autocomplete no campo de entrada
        function initAutocomplete() {
            const input = document.getElementById('endereco');
            const autocomplete = new google.maps.places.Autocomplete(input, {
                types: ['geocode'], // Filtra para endereços físicos
                componentRestrictions: { country: 'br' } // Restringe ao Brasil
            });
        }

        // Lista de endereços adicionados
        let enderecos = [];

        // Adiciona um endereço à lista
        document.getElementById('adicionar-endereco').addEventListener('click', () => {
            const enderecoInput = document.getElementById('endereco');
            const endereco = enderecoInput.value.trim();

            if (endereco) {
                enderecos.push(endereco);
                atualizarListaEnderecos();
                enderecoInput.value = ''; // Limpa o campo de entrada
            } else {
                alert('Por favor, insira um endereço válido.');
            }
        });

        // Atualiza a lista de endereços na tela
        function atualizarListaEnderecos() {
            const lista = document.getElementById('lista-enderecos');
            lista.innerHTML = ''; // Limpa a lista

            enderecos.forEach((endereco, index) => {
                const item = document.createElement('div');
                item.className = 'endereco-item';
                item.innerHTML = `
                    <span>${endereco}</span>
                    <span class="remover-endereco" onclick="removerEndereco(${index})">Remover</span>
                `;
                lista.appendChild(item);
            });
        }

        // Remove um endereço da lista
        window.removerEndereco = function(index) {
            enderecos.splice(index, 1);
            atualizarListaEnderecos();
        };

        // Envia os endereços para o back-end e gera a rota
        document.getElementById('gerar-rota').addEventListener('click', () => {
            if (enderecos.length < 2) {
                alert('Adicione pelo menos dois endereços para calcular a rota.');
                return;
            }

            fetch('/calcular-rota', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enderecos: enderecos }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    // Exibe o QR Code
                    const qrCodeImage = document.getElementById('qr-code-image');
                    qrCodeImage.src = `data:image/png;base64,${data.qrcode}`;
                    qrCodeImage.style.display = 'block';

                    // Exibe sugestões (se houver)
                    if (data.suggestions && data.suggestions.length > 0) {
                        alert('Sugestões: ' + data.suggestions.join('\n'));
                    }
                }
            })
            .catch(error => {
                console.error('Erro ao enviar endereços:', error);
            });
        });

        // Inicializa o autocomplete quando a página carregar
        window.onload = initAutocomplete;
    </script>
</body>
</html>
